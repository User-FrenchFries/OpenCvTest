### 1. 竞品调研（Android端且除动图外）

#### 1. 微博

> 对于基本的图片，用户在上传前可以对其做很多处理。具体功能点如下

##### 1. 在原始图像上添加内容的（都会覆盖掉原始图片的内容，主要为图像的合成）

1. 标签-----在整个图像上层添加一个Tag标签（标签点击不响应任何事件）
2. 贴纸-----在图像上层添加一个图片
3. 文字-----在图像的某个位置放置文本内容
4. 边框----基于整个图片外围，添加对应的边框覆盖
5. 涂鸦----在图像上覆盖一层笔迹，特殊的为 马赛克

##### 2. 对原始图片进行处理（多种效果是可以叠加的，主要为图像处理）

1. 滤镜----对当前图片进行处理，使得图片展现出不同的样式
2. 美颜----主要针对人像（在微博中，如果上传图片未检测出人像，则无法启用该功能）
   1. 一键美颜
   2. 美白
   3. 磨皮
   4. 瘦脸
   5. 大眼
   6. 白牙
   7. 祛眼袋
   8. 祛法令纹

##### 3. 图片的基本处理（此部分基本不涉及到算法的使用）

1. 裁剪---对图片的大小，宽高比例进行修改

#### 2. Twitter

> 在上传图片的时候，可以选择对图片进行预处理，主要功能点如下：
>
> 但是，Twitter的照片可能只针对的其中的内容，人像暂无处理

##### 1. 在原始图片上增加内容

1. 贴纸----需要下载，无网络或者网络差显示提示内容

##### 2. 图片的滤镜处理

1. 一键美化（点击后即可直接生效，但仅仅是对用户上传图片的效果优化。如果里面有人像，处理前后无变化）
2. 自选滤镜调整（单击所选滤镜后，再次点击所选滤镜出现滑动按钮，可以调节该滤镜下的参数，改变图像输出效果）

##### 3. 图像的基本处理

1. 裁剪

##### 4. 图片的无障碍处理

1. 添加描述文本，可以让用户在无障碍模式的时候感知图片内容

### 2. 对应功能点技术原理及其实现

#### 1. 在图片上添加内容

> 对于在图片上添加内容，不论是一张图片，还是文本文字，抑或是图片的边框，这种的原理内容基本一致。

1. 实现原理：

   1. 如果是仅仅用作展示，并不需要对图片进行破坏的话，可以生成一个自定义View，下层展示图片，上层展示各类处理，展示的也是由系统的UI绘制展现出最终的效果。（这种形式较简单，暂不做讲解）
   2. 如果需要进行永久性处理，即处理后的图片导出，仍存在标签，那么就涉及到图片的合成处理。原理实现如下：

   > 贴纸是在原图上覆盖了一层新的像素集合(静态)，动态贴纸是按一定规则时时改变贴纸的位置而已
   >
   > 贴纸实际上就是讲图片转换为纹理，然后输出在屏幕上。我们平时看到的图片，其实都可以看作是计算机中的纹理，将对应纹理贴在展示位置上，就输出了图像，贴纸只是让计算机相当于输出了两个纹理，只是两张纹理的范围不一样。

   基于OpenGLES，我们可以将图片转化为纹理，然后再将纹理通过其内置的方法将贴纸纹理在对应位置坐标上与原图像纹理进行混合后再输出展现。当然，最终混合后得到的纹理可以转化为一张处理后的图片。此时处理后的图片与原图片已经不再是同一张。

   具体实现流程可以参考如下链接：[2D图像贴纸](https://blog.csdn.net/liuderong0/article/details/99351296?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-99351296-blog-117540983.topnsimilarv1&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-99351296-blog-117540983.topnsimilarv1&utm_relevant_index=1)

#### 2. 对图片做马赛克处理

>  图像打码其实也是图像卷积操作中，空间域滤波的一种方式，用一定大小的滤波器对马赛克范围内像素进行操作
>
> 实现过程：将需要打马范围按照滤波器大小划分为多个区块，取滤波器范围内像素，求取均值，再将均值赋值给范围内每一个像素，滤波器再滑到下一个区块。
>
> 对整张图片打码也叫做像素格特效，我们只需要考虑滤波器大小即可。

1. 如上，马赛克即是一种常见的图片处理技术，他是对原始图像中的像素破坏重建的一种功能，所得的处理图片和原始图像并不相同
2. 在竞品的图像处理中，都是通过画笔，将涂抹后的部分进行马赛克化展示

具体的马赛克处理代码链接如下：[马赛克处理](https://blog.csdn.net/jameschen9051/article/details/99174987)

#### 3. 对图片进行涂鸦

> 涂鸦本质上其实也是在图片上进行数据的修改，实现方式有很多种。比如可以将涂鸦的内容当作一张新图片，再用图片合并的原理，去得到处理后的内容；除此之外，我们还可以将其所有内容全部导入到画布当中，用画布呈现所有内容，也可以将画布上的内容再次转化为图片保存。

1. 对于画布实现来说，其实就是将图片先导入进去，再添加对应的点击事件，在画布上再绘制涂鸦内容。

具体实现可以参照如下链接：[canvas绘制图片涂鸦](https://cloud.tencent.com/developer/article/1741510)

#### 4. 对图片做滤镜处理

> 这些处理是对整张图像中的像素的统一处理，处理像素的方法不同，也就导致了最终的输出效果不同，而这些处理也被称之为不同的滤镜。比如将图片整体灰度化展现，此滤镜被称之为黑白

1. 滤镜操作其实就是一些基本的数学处理，通过不同的像素变换使得原始图片展示出各种效果，比如更加清晰，对比度更强等。

常用的滤镜处理算法可以参照此链接：[滤镜原理即实现讲解](https://www.kancloud.cn/trent/hotoimagefilter/102794)

#### 5. 对图片做美颜处理

> 原理讲解：美颜是的基本原理就是深度学习加计算机图形学。深度学习用来人脸检测和人脸关键点检测。计算机图形学用来磨皮，瘦脸和画妆容。一般在Android上使用OpenGLES，IOS为Metal
>
> [OpenGL ES学习参考链接](https://blog.csdn.net/oShunz/article/details/50537631?spm=1001.2101.3001.6650.9&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-9-50537631-blog-79168469.pc_relevant_multi_platform_featuressortv2dupreplace&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-9-50537631-blog-79168469.pc_relevant_multi_platform_featuressortv2dupreplace&utm_relevant_index=10)
>
> 必备技术：深度学习（人脸检测）、图像处理（磨皮实现）
>
> 当然，不同功能点操作的人脸模块不同，采用的处理方法也不同

###### 1. 红唇实现：

通过人脸检测模块获取到识别的图像流，截取唇部信息快，更改其中的颜色，再进行图像绘制，即可完成红唇特效

1. [canvas绘制红唇](https://juejin.cn/post/6855129006367309832)

###### 2. 皮肤美白：

对于美白来说，本质其实就是对图像进行亮度增加操作。但是，如果只针对整个图像进行亮度提升，可能效果不是很好（图像的展示还需要考虑对比度），那么，可以使用人脸关键点检测，得到需要处理的皮肤快，再对其中的皮肤进行亮度的修正

###### 3. 磨皮：

本质上就是将一些像素点进行模糊处理，这里可以使用高斯模糊。这样，人像中的一些瑕疵内容通过处理后，就会变得非常不显眼。搭配上人脸关键点检测，可以随意修正人脸中的图像快（可以用于祛眼袋，祛法令纹，白牙）

1. [人像磨皮参考链接](https://blog.csdn.net/King1425/article/details/77776931)

###### 4. 瘦脸：

本质上都是对图像中某些区域的像素按照我们设定的规则进行移动，而 OpenGL 的片段着色器天然适合处理像素（纹素）层面的操作-----》即移动像素，使用工具为OpenGL

瘦脸效果的实现，是将指定区域内的像素按照一定的规则进行整体偏移，从而形成一种对脸部挤压的效果-------》需要选取关键点，从而得到挤压的方向，关键点使用的越多，图像处理的越精细

###### 5. 大眼：

大眼效果仍然是对整个图像中某一区块中的像素进行移动操作，与瘦脸相同

OpenGL 实现大眼效果，可以参照放大镜的实现原理，即将纹理上一块区域采样后映射到一块相对较大的区域

1. [实现人像瘦脸和大眼](https://juejin.cn/post/6844904094327390215)

###### 6. 一键美颜：

​    一键美颜的实现是建立在美颜、美型、滤镜的基础上实现的。可以这样说，一键美颜的功能里包含美白、磨皮、大眼、瘦脸等功能，将它们的参数按比例设置好，同时一键美颜包含多种风格，比如：萝莉、女神、网红、油画等功能，这里面还要加上滤镜的参数，针对不同的风格配置不一样的滤镜。

​    即由人工智能去动态调整一副图像中不同效果的参数，得到一副最好的图像展示（此人工智能需要进行图像的训练，人为对处理后图像进行打分，迭代训练，输出图像的质量高低正取决于机器学习的质量）

**此种类型暂无实例讲解**

### 3. 美颜可以使用的现有SDK（收费，需要购买）

#### 1. [Face++](https://www.faceplusplus.com.cn/sdk/facebeautify/)

1. 有可以集成的SDK，可以完成实时的图像处理（支持智能美颜功能）
2. 可以应用于美颜相机、视频直播美颜

#### 2. [阿里云图像处理服务](https://help.aliyun.com/document_detail/159210.html)

1. 支持内容：可以对图像中的人脸进行美颜，包括磨皮、美白、去除黑眼圈、法令纹等
2. 支持场景：美颜相机，直播，短视频，摄影后期

### 4. 个人调研结果

1. 对于具体实现来说：裁剪翻转等为基本功能，基本不改变图片的内容；图片上添加内容，抑或是滤镜处理，都需要对图片的像素进行数学方法的处理，以达到对应的目的；人像的美颜，需要结合人像关键点捕捉，再通过比较好使用的方法库对识别得到的区块进行相应处理，以达到对应的目的。

2. 通过调研竞品中上传图片的功能，发现或多或少都包含对用户图像处理的功能。其中基本功能如图像裁剪、翻转，几乎所有使用到图片的时候都会支持该处理。图像的基本滤镜处理也都会支持（如黑白化，柔和化等）。但是，人脸的美颜，也仅在某些竞品中出现（今日头条、QQ中无人像美颜处理功能，一般社交属性的APP可能会用到美颜功能（此后半句推论仅个人理解，可能有误））。当然，具体的功能实现可以参照上述的讲解。

3. 由于我们具体的使用场景为论坛版块，此板块中更多出现的图片可能会是用户分享的菜谱或者制作成功后的菜品图片，那么基本的**图像处理是不可少的（翻转等）**，其次，用户可能希望屏蔽掉整张图片中某些敏感信息，那么**局部马赛克功能应该也需要**，除此之外，基本的图像滤镜、图像贴纸（可以用于实现打tag）也是需要的

4. 对于人像处理来说，如果需要得到效果完美，运行速度快，第三方的现有SDK是一个不错的选择，但是会有收费的限制。当然，是否需要接入人像美颜处理还需要运营和大数据同事对论坛用户进行需求分析，如果人脸出现频次较高的话，用户确实有该需求的话，可以考虑将此功能接入到论坛组件中。（这部分内容为个人见解，不一定正确。）

